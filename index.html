<!doctype html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>折讓單</title>
  </head>

  <body>
    <div style="margin-left:30px; font-size:40px; width:1000px; text-align: center" >折讓單產生器</div>

   <!-- PDF 顯示區域 -->
    <iframe id="iframe123" frameborder="0" width="1000" height="760" style="margin-left:10px;margin-bottom:30px; float:left" >
<!--    <iframe id="iframe123" frameborder="0" width="592" height="870" style="margin-left:30px" >-->
    </iframe>
  
    <div style="margin-left:10px; float:left">
      <button style="font-size:20px; background:blue; color:white" onclick="alert('此功能尚未完成')" >更新(尚未完成)</button><br><br>
      
      <label>折讓日期:</label>
      <input type="date" id="折讓日期" style="width:386px"><br><br>

      <label>折讓合計金額:</label>
      <input type="text" id="折讓合計金額" size="50"><br><br>               
      <hr>
      
      <label>發票聯式1:</label>
      <select id="發票聯式1" style="width:392px; height:23px">
        <option value=2>二聯式</option>
        <option value=3>三聯式</option>
      </select><br><br>
      
      <label>發票日期1:</label>
      <input type="date" id="發票日期1" style="width:386px"><br><br>
            
      <label>發票號碼1:</label>
      <input type="text" id="發票號碼1" size="50"><br><br>      
            
      <label>發票品名1:</label>
      <input type="text" id="發票品名1" size="50"><br><br> 
                  
      <label>發票數量1:</label>
      <input type="text" id="發票數量1" size="50"><br><br> 
                  
      <label>發票單價1:</label>
      <input type="text" id="發票單價1" size="50"><br><br> 
                  
      <label>折讓金額1:</label>
      <input type="text" id="折讓金額1" size="50"><br><br>   
                  
      <label>是否應稅1:</label>
      <select id="是否應稅1" style="width:392px; height:23px">
        <option value=1>應稅(5%)</option>
        <option value=2>零稅率(0%)</option>
        <option value=3>免稅(0%)</option>        
      </select><br><br>   
      <hr>
      
      <label>發票聯式2:</label>
      <select id="發票聯式1" style="width:392px; height:23px">
        <option value=2>二聯式</option>
        <option value=3>三聯式</option>
      </select><br><br>
      <label>發票日期2:</label>
      <input type="date" id="發票日期2" style="width:386px"><br><br>
            
      <label>發票號碼2:</label>
      <input type="text" id="發票號碼2" size="50"><br><br>      
            
      <label>發票品名2:</label>
      <input type="text" id="發票品名2" size="50"><br><br> 
                  
      <label>發票數量2:</label>
      <input type="text" id="發票數量2" size="50"><br><br> 
                  
      <label>發票單價2:</label>
      <input type="text" id="發票單價2" size="50"><br><br> 
                  
      <label>折讓金額2:</label>
      <input type="text" id="折讓金額2" size="50"><br><br>   
                  
      <label>是否應稅2:</label>
      <select id="是否應稅2" style="width:392px; height:23px">
        <option value=1>應稅(5%)</option>
        <option value=2>零稅率(0%)</option>
        <option value=3>免稅(0%)</option>        
      </select><br><br>                                         
      <hr>
      
      <label>發票聯式3:</label>
      <select id="發票聯式3" style="width:392px; height:23px">
        <option value=2>二聯式</option>
        <option value=3>三聯式</option>
      </select><br><br>
      <label>發票日期3:</label>
      <input type="date" id="發票日期3" style="width:386px"><br><br>
            
      <label>發票號碼3:</label>
      <input type="text" id="發票號碼3" size="50"><br><br>      
            
      <label>發票品名3:</label>
      <input type="text" id="發票品名3" size="50"><br><br> 
                  
      <label>發票數量3:</label>
      <input type="text" id="發票數量3" size="50"><br><br> 
                  
      <label>發票單價3:</label>
      <input type="text" id="發票單價3" size="50"><br><br> 
                  
      <label>折讓金額3:</label>
      <input type="text" id="折讓金額3" size="50"><br><br>   
                  
      <label>是否應稅3:</label>
      <select id="是否應稅3" style="width:392px; height:23px">
        <option value=1>應稅(5%)</option>
        <option value=2>零稅率(0%)</option>
        <option value=3>免稅(0%)</option>        
      </select><br><br>       
      <hr>
      
      <label>發票聯式4:</label>
      <select id="發票聯式4" style="width:392px; height:23px">
        <option value=2>二聯式</option>
        <option value=3>三聯式</option>
      </select><br><br>
      <label>發票日期4:</label>
      <input type="date" id="發票日期4" style="width:386px"><br><br>
            
      <label>發票號碼4:</label>
      <input type="text" id="發票號碼4" size="50"><br><br>      
            
      <label>發票品名4:</label>
      <input type="text" id="發票品名4" size="50"><br><br> 
                  
      <label>發票數量4:</label>
      <input type="text" id="發票數量4" size="50"><br><br> 
                  
      <label>發票單價4:</label>
      <input type="text" id="發票單價4" size="50"><br><br> 
                  
      <label>折讓金額4:</label>
      <input type="text" id="折讓金額4" size="50"><br><br>   
                  
      <label>是否應稅4:</label>
      <select id="是否應稅4" style="width:392px; height:23px">
        <option value=1>應稅(5%)</option>
        <option value=2>零稅率(0%)</option>
        <option value=3>免稅(0%)</option>        
      </select><br><br>                          
                                                      
    </div>
    
    <!-- V1.3.2 -->
    <!--<script src = "https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script>-->
    <!--<script src = "jspdf.debug.1.3.2.js"></script>-->
    
    <!-- V2.3.0 -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.0/jspdf.umd.min.js"></script>-->    
    <script src = "jspdf.umd.2.3.0.js"></script>
        
    
    <!--以下自 https://rawgit.com/MrRio/jsPDF/master/fontconverter/fontconverter.html 轉換 TTF 字型檔-->
    <!--免費中文字型下載 https://www.fairyhorn.cc/1526/chinese-fonts-free-download -->
    <script src = "王漢宗中明體繁-normal.js"></script>
    <script src = "王漢宗特黑體繁-normal.js"></script>
    <script src = "opens-normal.js"></script><!--打勾的符號字型-->

    <!--rebate is a Base64 encoded string of rebate-using-王漢宗中明體繁.jpg by https://www.base64-image.de-->
<!--    <script src="rebate-base64.js"></script>-->
    
    <script src="base64img.js"></script><!--將 img 進行 base64 編碼-->
    <script src="dateConvert.js"></script>
       
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
    <script src="jquery3.5.1.min.js"></script>
        
    <script>
      function drawPDF(background){
        const queryString = window.location.search;
        console.log(queryString);
        const urlParams = new URLSearchParams(queryString);
        console.log(urlParams);
        const date = urlParams.get('聯式')
        console.log(date);

        window.jsPDF = window.jspdf.jsPDF; // add this line of code

        var opt = {
         orientation: 'l',
         hotfixes: ["px_scaling"],
         unit: 'px',
         format: 'a4',
         putOnlyUsedFonts:true,
         floatPrecision: 16 // or "smart", default is 16
        }

        var doc = new jsPDF(opt);


        doc.setFont('王漢宗中明體繁');
        doc.setFontSize(7);

        // doc.addImage(rebate, 10, 10, 780, 480);
        //doc.addImage(background, 10, 10, 780, 480);
        doc.addImage(background, 35, 30, 500, 308);
        doc.addImage(background, 595, 30, 500, 308);
        doc.addImage(background, 35, 450, 500, 308);
        doc.addImage(background, 595, 450, 500, 308);     
        
        doc.setLineDash([10, 10], 0);
        doc.line(0, 410, 1140, 410);        
        doc.line(563, 0, 563, 888);        
        
        var startX=0;
        var startY=0;
        var deltaX=562;
        var deltaY=420;
        
        doc.text('台灣萊札普股份',   startX+102, startY+40);
        doc.text('有限公司',        startX+102, startY+50);
        doc.text('83500950',       startX+102, startY+66);
        doc.text('台北市中山區南京',  startX+102, startY+83);
        doc.text('東路一段86號5樓',  startX+102, startY+93);
        doc.text('110',            startX+265, startY+90);  //年
        doc.text('3',              startX+305, startY+90);    //月
        doc.text('3',              startX+340, startX+90);    //日      
        doc.text('二',             startX+40, startY+174);    //聯式      
        doc.text('109.03.01',      startX+53, startX+174);    //發票日期  
        doc.text('MN-02860182',    startX+100, startY+174);    //發票號碼          
        doc.text('標準24堂課程',    startX+172, startY+174);    //發票號碼 
        doc.text('1',             startX+245, startY+174);    //數量         
        doc.text('50,000',        startX+265, startY+174);    //單價         
        doc.text('50,000',        startX+300, startY+174);    //折讓金額         
        doc.text('5%',            startX+380, startY+174);    //營業稅額         
        doc.text('康博銓',         startX+105, startY+305);    //原買受人名稱    
        doc.text('56662635',      startX+105, startY+327);    //原買受人統一編號          
        doc.text('350401 苗栗市竹南鎮科北五路二號三樓', startX+276, startY+286.5);    //原買受人地址         
        
        doc.text('台灣萊札普股份',   startX+deltaX+102, startY+40);
        doc.text('有限公司',        startX+deltaX+102, startY+50);
        doc.text('83500950',       startX+deltaX+102, startY+66);
        doc.text('台北市中山區南京',  startX+deltaX+102, startY+83);
        doc.text('東路一段86號5樓',  startX+deltaX+102, startY+93);
        doc.text('110',            startX+deltaX+265, startY+90);  //年
        doc.text('3',              startX+deltaX+305, startY+90);    //月
        doc.text('3',              startX+deltaX+340, startX+90);    //日      
        doc.text('二',             startX+deltaX+40, startY+174);    //聯式      
        doc.text('109.03.01',      startX+deltaX+53, startX+174);    //發票日期  
        doc.text('MN-02860182',    startX+deltaX+100, startY+174);    //發票號碼          
        doc.text('標準24堂課程',    startX+deltaX+172, startY+174);    //發票號碼 
        doc.text('1',             startX+deltaX+245, startY+174);    //數量         
        doc.text('50,000',        startX+deltaX+265, startY+174);    //單價         
        doc.text('50,000',        startX+deltaX+300, startY+174);    //折讓金額         
        doc.text('5%',            startX+deltaX+380, startY+174);    //營業稅額         
        doc.text('康博銓',         startX+deltaX+105, startY+305);    //原買受人名稱    
        doc.text('56662635',      startX+deltaX+105, startY+327);    //原買受人統一編號          
        doc.text('350401 苗栗市竹南鎮科北五路二號三樓', startX+deltaX+276, startY+286.5);    //原買受人地址               
         
        doc.text('台灣萊札普股份',   startX+102, startY+deltaY+40);
        doc.text('有限公司',        startX+102, startY+deltaY+50);
        doc.text('83500950',       startX+102, startY+deltaY+66);
        doc.text('台北市中山區南京',  startX+102, startY+deltaY+83);
        doc.text('東路一段86號5樓',  startX+102, startY+deltaY+93);
        doc.text('110',            startX+265, startY+deltaY+90);  //年
        doc.text('3',              startX+305, startY+deltaY+90);    //月
        doc.text('3',              startX+340, startY+deltaY+90);    //日      
        doc.text('二',             startX+40, startY+deltaY+174);    //聯式      
        doc.text('109.03.01',      startX+53, startY+deltaY+174);    //發票日期  
        doc.text('MN-02860182',    startX+100, startY+deltaY+174);    //發票號碼          
        doc.text('標準24堂課程',    startX+172, startY+deltaY+174);    //發票號碼 
        doc.text('1',             startX+245, startY+deltaY+174);    //數量         
        doc.text('50,000',        startX+265, startY+deltaY+174);    //單價         
        doc.text('50,000',        startX+300, startY+deltaY+174);    //折讓金額         
        doc.text('5%',            startX+380, startY+deltaY+174);    //營業稅額         
        doc.text('康博銓',         startX+105, startY+deltaY+305);    //原買受人名稱    
        doc.text('56662635',      startX+105, startY+deltaY+327);    //原買受人統一編號          
        doc.text('350401 苗栗市竹南鎮科北五路二號三樓', startX+276, startY+deltaY+286.5);    //原買受人地址        
        
        doc.text('台灣萊札普股份',   startX+deltaX+102, startY+deltaY+40);
        doc.text('有限公司',        startX+deltaX+102, startY+deltaY+50);
        doc.text('83500950',       startX+deltaX+102, startY+deltaY+66);
        doc.text('台北市中山區南京',  startX+deltaX+102, startY+deltaY+83);
        doc.text('東路一段86號5樓',  startX+deltaX+102, startY+deltaY+93);
        doc.text('110',            startX+deltaX+265, startY+deltaY+90);  //年
        doc.text('3',              startX+deltaX+305, startY+deltaY+90);    //月
        doc.text('3',              startX+deltaX+340, startY+deltaY+90);    //日      
        doc.text('二',             startX+deltaX+40, startY+deltaY+174);    //聯式      
        doc.text('109.03.01',      startX+deltaX+53, startY+deltaY+174);    //發票日期  
        doc.text('MN-02860182',    startX+deltaX+100, startY+deltaY+174);    //發票號碼          
        doc.text('標準24堂課程',    startX+deltaX+172, startY+deltaY+174);    //發票號碼 
        doc.text('1',             startX+deltaX+245, startY+deltaY+174);    //數量         
        doc.text('50,000',        startX+deltaX+265, startY+deltaY+174);    //單價         
        doc.text('50,000',        startX+deltaX+300, startY+deltaY+174);    //折讓金額         
        doc.text('5%',            startX+deltaX+380, startY+deltaY+174);    //營業稅額         
        doc.text('康博銓',         startX+deltaX+105, startY+deltaY+305);    //原買受人名稱    
        doc.text('56662635',      startX+deltaX+105, startY+deltaY+327);    //原買受人統一編號          
        doc.text('350401 苗栗市竹南鎮科北五路二號三樓', startX+deltaX+276, startY+deltaY+286.5);    //原買受人地址          
        
//        doc.text('台灣萊札普股份', 662, 460);
//        doc.text('有限公司', 662, 470);   
//        doc.text('83500950', 662, 486);
//        doc.text('台北市中山區南京', 662, 503);
//        doc.text('東路一段86號5樓', 662, 513);  
//        doc.text('110', 825, 510);  //年
//        doc.text('3', 865, 510);    //月
//        doc.text('3', 900, 510);    //日  
//        doc.text('二', 600, 594);    //聯式          
//        doc.text('109.03.01', 613, 594);    //發票日期   
//        doc.text('MN-02860182', 660, 594);    //發票號碼          
        

        doc.setFont('opens');
        doc.setFontSize(10);
        doc.text('✔', 488, 104); //第一聯
        doc.text('✔', 1060, 104); //第二聯
        doc.text('✔', 500, 523); //第三聯
        doc.text('✔', 1083, 524); //第四聯
        
        doc.text('✔', 420, 175); //應稅1        
        doc.text('✔', 980, 175); //應稅2   
        doc.text('✔', 420, 595); //應稅3        
        doc.text('✔', 980, 595); //應稅4           

        //doc.save("test.pdf");
        //document.getElementById("iframe123").src = doc.output('datauristring');//在iframe中顯示
        $("#iframe123").attr("src", doc.output('datauristring'));
      }
      
  
      var img = new Image();
      img.src = "rebate-using-王漢宗中明體繁.jpg";
          
//      img.addEventListener("load", function() {
//
//        var backgroundStr=imgToBase64(img);
//        
//        drawPDF(backgroundStr);        
//        
//      }, false);
      
      img.onload = function () {
        var backgroundStr=imgToBase64(img);
        drawPDF(backgroundStr);        
      }
      
    </script>

    <style>
      label {
        width:110px;
        display: inline-block;
      }      
    </style>

  </body>

</html>